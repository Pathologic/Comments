# Вывод комментариев
Комментарии выводятся с помощью DocLister, при этом в некоторых контроллерах функциональность DocLister ограничена. Параметры по умолчанию задаются в коде сниппета Comments и конфиге assets/snippets/Comments/config/comments.json. Скрипт comments.js, а также ajax-обработчик, рассчитаны именно на эту конфигурацию.

Параметры, с которыми вызывается сниппет Comments сохраняются в БД для использования ajax-обработчиком. К сожалению, при этом теряется возможность использовать в качестве параметров анонимные функции и объекты.

## Требования к верстке
При изменении шаблонов по умолчанию требуется соблюдать определенные требования для корректной работы скрипта comments.js.

Блок с выводом количества комментариев и список комментариев должны быть обернуты в элемент с id="comments":
```
<div id="comments">
    ... <!-- Здесь выводится информация о количестве комментариев или их отсутствии !-->
    ... <!-- Здесь выводятся комментарии -->
</div>
```

Элемент в котором выводится количество комментариев должен быть обернут в элемент с классом "comments-count-wrap" и иметь класс "comments-count", :
```
<div class="comments-count-wrap hidden"><span class="comments-count">0</span></div>
```

Дополнительно может использоваться элемент с классом "no-comments":
```
<div class="no-comments">Ваш комментарий будет первым.</div>
```

При загрузке новых комментариев у блока с классом "comments-count-wrap" удаляется класс hidden, а блоку с классом  "no-comments" добавляется класс "hidden".

Блок, в котором выводится комментарий должен иметь класс "comment" и data-атрибуты:
* data-id - id комментария;
* data-level - уровень в иерархии;
* data-edit-ttl - время редактирования комментария (необязательно).

Пример:
```
<div class="comment {{ data.classes | join(' ') }}" data-id="{{ data.id }}" data-level="{{ data.level }}" id="comment-{{ data.id }}" {% if data['edit-ttl'] %}data-edit-ttl="{{ data['edit-ttl'] }}"{% endif %}>
...
</div>
```

Блоку комментария присваиваются дополнительные классы:
* published, unpublished - опубликованный/неопубликованный комментарий;
* deleted - удаленный комментарий;
* updated - измененный комментарий;
* anonymous - анонимный комментарий;
* author - комментарий от автора комментируемого ресурса;
* editable - комментарий можно редактировать;
* levelN - комментарий уровня N.

Имена классов можно изменить с помощью параметра имя_классаClass:
```
&deletedClass=`deleted`
&levelClass=`level`
```

Кнопки для ответа на комментарий и для редактирования комментария должны иметь классы:
* comment-reply - для ответа;
* comment-update - для редактирования.

Названия классов не являются обязательными и могут быть переопределены при запуске скрипта comments.js.

## Контроллер TreeView 
Выводит комментарии плоским списком, но с сортировкой согласно их иерархии. За счет отступов это выглядит как дерево, но деревом совсем не является. Плюсом такого решения является теоретически низкое потребление ресурсов: основные данные выбираются из базы за один запрос.

Сортировка комментариев и пагинация не предусмотрена, вывод рассчитан исключительно на использование шаблонизатора.

Вызывается с помощью сниппета Comments.

### Параметры
* threadCreator - id создателя комментируемого ресурса;
* moderatedByThreadCreator - если 1, то разрешить создателю ресурса модерировать комментарии (по умолчанию 0); 
* wrapTpl - шаблон-обертка списка комментариев;
* tpl - шаблон отдельного комментария;
* context - тип комментируемого ресурса (по умолчанию - site_content), зарезервировано для будущих разработок;
* thread - id комментируемого ресурса (по умолчанию - текущая страница);
* hideUnpublished - если 1 (по умолчанию), то не выводить неопубликованные комментарии;
* hideDeleted - если 1 (по умолчанию), то не выводить удаленные комментарии;
* trackNew - если 1, то отмечать (задается поле new) новые комментарии (только для зарегистрированных пользователей); 
* rtssElement - название набора параметров для использования в ajax-обработчике;
* editTime - время на редактирование комментария в секундах, 0 если ограничения нет (по умолчанию 180 секунд).
* extendedFields - список дополнительных полей, через запятую;
* mode - режим вывода. Возможные значения: comments, recent. В режиме comments выводится список комментариев, а режим recent предназначен для вывода комментариев в виде json для ajax-подгрузки в скрипте comments.js.

Параметры классов:
editableClass - если разрешено редактировать, по умолчанию editable;
levelClass - уровень в иерархии, по умолчанию level;
newClass - для новых комментариев, по умолчанию new;
publishedClass - для опубликованных комментариев, по умолчанию published;
unpublishedClass - для скрытых комментариев, по умолчанию unpublished;
deletedClass - для удаленных комментариев, по умолчанию deleted;
updatedClass - для измененных комментариев, по умолчанию updated;
guestClass - для анонимных комментариев, по умолчанию guest;
authorClass - если пользователь является создателем ресурса, по умолчанию author.

При вызове устанавливаются глобальные плейсхолдеры count (количество комментариев) и lastComment (id последнего комментария).

## Контроллер RecentComments
Выводит список последних прокомментированных ресурсов. Вызывается с помощью сниппета RecentComments. Вывод происходит с помощью шаблонизатора в чанке, указанном в параметре &tpl. Параметры по умолчанию в коде сниппета и файле assets/snippets/Comments/config/comments.json.




